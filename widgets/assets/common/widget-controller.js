let deck=null;function getDeck(){return deck||(deck=document.querySelector("ad-frame-deck")),deck}const WidgetController={_overlayWidgetMap:new Map,_protectedTargets:new Set,handlePlay(e){let t=e._widgetOrder;if(!t)return;let r=WidgetController._overlayWidgetMap.get(t);if(r&&(r.completed+=1,r.completed>=r.total)){if("1"===e._overlayOn){let l=getDeck();if(!l)return;WidgetController._protectedTargets.clear(),l.querySelectorAll('wgt-peel[mode="2"], wgt-scratch-card[mode="2"]').forEach(e=>{console.log("Protected widget:",e);let t=e.getAttribute("reveal_widget"),r=t&&document.querySelector(`[order="${t}"]`);r?.tagName.startsWith("WGT-")&&WidgetController._protectedTargets.add(r)}),l.querySelectorAll("*").forEach(e=>{!e.tagName.startsWith("WGT-")||WidgetController._protectedTargets.has(e)||e.closest("widget-wrapper")||e.setAttribute("paused","false")})}else e._target?.tagName.startsWith("WGT-")&&e._target.setAttribute("paused","false");WidgetController._overlayWidgetMap.delete(t)}},waitForTargetAndInit(e,t){let r=e._overlayOn,l=e.getAttribute("reveal_widget"),a=()=>{let a;if("1"===r){let o=getDeck()||document.body;o?.querySelectorAll("*").forEach(e=>{!e.closest("widget-wrapper")&&e.tagName.startsWith("WGT-")&&e.setAttribute("paused","true")}),a=o}else l&&((a=document.querySelector(`[order="${l}"]`))&&a.tagName.startsWith("WGT-")?a.setAttribute("paused","true"):a=null);a&&(e._observer?.disconnect(),t.call(e,a))};a(),e._observer=new MutationObserver(a),e._observer.observe(document.body,{childList:!0,subtree:!0})}};window.WidgetController=WidgetController;