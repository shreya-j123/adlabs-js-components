class WgtVideoPlayer extends HTMLElement{constructor(){super(),this.player=null,this.connected=!1,this.observer=null,this.isRendered=!1,this.isStarted=!1,this.isCompleted=!1,this.progressTracked={25:!1,50:!1,75:!1,100:!1},this.adWidgetId=null,this.widgetId=null,this.isInView=!1,this.isDocumentVisible=!0}static get observedAttributes(){return["video_src","section_bg_color","poster_src","cta_url","ad_widget_id","widget_id","paused","widget_order","order"]}connectedCallback(){this.render(),this.connected=!0,this.isDocumentVisible="visible"===document.visibilityState,document.addEventListener("visibilitychange",this._handleDocumentVisibilityChange.bind(this))}disconnectedCallback(){this.destroy(),document.removeEventListener("visibilitychange",this._handleDocumentVisibilityChange.bind(this))}attributeChangedCallback(e,t,i){if(this.connected&&t!==i){if("video_src"===e){!t&&i?this.render():t&&!i?this.destroy():t!==i&&this.player&&this.player.src({type:"video/mp4",src:i});return}"poster_src"===e&&this.player&&this.player.poster(i),"section_bg_color"===e&&(this.style.backgroundColor=i,console.log(e)),"cta_url"===e&&this.setupClickOverlay(),"ad_widget_id"===e&&(this.adWidgetId=i),"widget_id"===e&&(this.widgetId=i),"paused"===e&&this._updatePlaybackState()}}_handleDocumentVisibilityChange(){this.isDocumentVisible="visible"===document.visibilityState,this._updatePlaybackState()}setupClickOverlay(){let e=this.querySelector(".click-overlay"),t=this.getAttribute("cta_url");this.getAttribute("order"),e&&t&&(e.onclick=()=>{AdEventTracker?.TrackingHelper?.triggerEvent?.({widgetId:this.widgetId,adWidgetId:this.adWidgetId,eventName:"Click",cumulative:!0,click:!0,engagement:!0})})}render(){this.isRendered||(this.isRendered=!0,this.initPlayer(),this.dispatchEvent(new CustomEvent("wgt-rendered",{bubbles:!0,composed:!0,detail:{tag:this.tagName.toLowerCase()}})))}initPlayer(){let e=`video-${Math.random().toString(36).substring(2,9)}`,t=this.getAttribute("video_src")||"",i=this.getAttribute("poster_src")||"",s=this.getAttribute("section_bg_color")||"#000",r=this.getAttribute("cta_url");this.getAttribute("order"),this.adWidgetId=this.getAttribute("ad_widget_id")||e,this.widgetId=this.getAttribute("widget_id")||null,this.style.backgroundColor=s;let a=/android/i.test(navigator.userAgent),d=!a;if(!t){this.destroy();return}if("undefined"==typeof videojs){console.warn("videojs is not defined yet. Retrying in 100ms..."),setTimeout(()=>{try{this.render()}catch(e){}},100);return}if(this.innerHTML=`
      <div class="wrapper ${this.hasAttribute("full-canvas")?"full-canvas":""}">
        <video
          id="${e}"
          class="video-js-block vjs-default-skin"
          poster="${i}"
          preload="auto"
          loop
          playsinline
          ${d?"muted":""}
        >
          <source src="${t}" type="video/mp4" />
        </video>

        ${r?'<div class="click-overlay"></div>':""}

        <div class="mute-unmute hidden">
          <button class="mute-button">
            <span class="mute-icon">
              ${d?this.getUnmuteIcon():this.getMuteIcon()}
            </span>
          </button>
        </div>

        <div class="play-overlay">
          <div class="play-icon">
            <span class="play-icon-svg">${this.getPlayIcon()}</span>
          </div>
        </div>
      </div>
    `,!t){this.player=null;return}this.querySelector(".wrapper");let l=this.querySelector(".mute-unmute"),n=this.querySelector(".mute-button"),o=this.querySelector(".mute-icon"),c=this.querySelector(".play-overlay");try{this.player=videojs(e,{controls:!1,autoplay:!1,muted:d,loop:!0,preload:"auto"})}catch(h){}this.player.ready(()=>{this.player.muted(d),this._updatePlaybackState()}),this.player.on("error",()=>{this.player.error()}),this.setupClickOverlay(),n?.addEventListener("click",e=>{e.stopPropagation();let t=this.player.muted();this.player.muted(!t),o.innerHTML=t?this.getMuteIcon():this.getUnmuteIcon(),AdEventTracker?.TrackingHelper?.triggerEvent?.({widgetId:this.widgetId,adWidgetId:this.adWidgetId,eventName:t?"Unmute":"Mute",cumulative:!1,click:!1,engagement:!0})}),c?.addEventListener("click",e=>{e.stopPropagation(),this.player.play().catch(()=>{})}),this.player.on("pause",()=>{c?.classList.remove("hidden"),l?.classList.add("hidden")}),this.player.on("play",()=>{c?.classList.add("hidden"),l?.classList.remove("hidden");let e=this.player.muted();AdEventTracker?.TrackingHelper?.triggerEvent?.({widgetId:this.widgetId,adWidgetId:this.adWidgetId,eventName:e?"StartMute":"StartUnmute",cumulative:!1,click:!1,engagement:!1}),this.isStarted||(this.dispatchEvent(new CustomEvent("wgt-started",{bubbles:!0,composed:!0,detail:{tag:this.tagName.toLowerCase()}})),this.isStarted=!0)}),this.player.on("timeupdate",()=>{let e=this.player.duration(),t=this.player.currentTime(),i=t/e*100;i>=25&&!this.progressTracked["25"]&&(AdEventTracker?.TrackingHelper?.triggerEvent?.({widgetId:this.widgetId,adWidgetId:this.adWidgetId,eventName:"FirstQuartile",cumulative:!1,click:!1,engagement:!1}),this.progressTracked["25"]=!0),i>=50&&!this.progressTracked["50"]&&(AdEventTracker?.TrackingHelper?.triggerEvent?.({widgetId:this.widgetId,adWidgetId:this.adWidgetId,eventName:"MidPoint",cumulative:!1,click:!1,engagement:!1}),this.progressTracked["50"]=!0),i>=75&&!this.progressTracked["75"]&&(AdEventTracker?.TrackingHelper?.triggerEvent?.({widgetId:this.widgetId,adWidgetId:this.adWidgetId,eventName:"ThirdQuartile",cumulative:!1,click:!1,engagement:!1}),this.progressTracked["75"]=!0),i>=98&&!this.progressTracked["100"]&&(AdEventTracker?.TrackingHelper?.triggerEvent?.({widgetId:this.widgetId,adWidgetId:this.adWidgetId,eventName:"Complete",cumulative:!1,click:!1,engagement:!1}),this.progressTracked["100"]=!0,this.isRendered&&!this.isCompleted&&(this.dispatchEvent(new CustomEvent("wgt-completed",{detail:{tag:this.tagName.toLowerCase()},bubbles:!0,composed:!0})),this.isCompleted=!0))}),this.observer=new IntersectionObserver(([e])=>{this.isInView=e.isIntersecting},{threshold:.5}),this.observer.observe(this.player.el())}_updatePlaybackState(){let e=this.hasAttribute("paused")&&"true"===this.getAttribute("paused");this.player&&(e?this.player.pause():this.isInView&&this.isDocumentVisible?this.player.play().catch(e=>{}):this.player.pause())}play(){this.hasAttribute("paused")&&"true"===this.getAttribute("paused")?this.pause():this._updatePlaybackState()}pause(){this.player&&this.player.pause()}resume(){this.hasAttribute("paused")&&"true"===this.getAttribute("paused")?this.pause():this._updatePlaybackState()}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.player&&(this.player.dispose(),this.player=null),this.innerHTML="",this.isRendered=!1}getMuteIcon(){return`
      <svg xmlns="http://www.w3.org/2000/svg" width="15" viewBox="0 0 640 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M533.6 32.5C598.5 85.2 640 165.8 640 256s-41.5 170.7-106.4 223.5c-10.3 8.4-25.4 6.8-33.8-3.5s-6.8-25.4 3.5-33.8C557.5 398.2 592 331.2 592 256s-34.5-142.2-88.7-186.3c-10.3-8.4-11.8-23.5-3.5-33.8s23.5-11.8 33.8-3.5zM473.1 107c43.2 35.2 70.9 88.9 70.9 149s-27.7 113.8-70.9 149c-10.3 8.4-25.4 6.8-33.8-3.5s-6.8-25.4 3.5-33.8C475.3 341.3 496 301.1 496 256s-20.7-85.3-53.2-111.8c-10.3-8.4-11.8-23.5-3.5-33.8s23.5-11.8 33.8-3.5zm-60.5 74.5C434.1 199.1 448 225.9 448 256s-13.9 56.9-35.4 74.5c-10.3 8.4-25.4 6.8-33.8-3.5s-6.8-25.4 3.5-33.8C393.1 284.4 400 271 400 256s-6.9-28.4-17.7-37.3c-10.3-8.4-11.8-23.5-3.5-33.8s23.5-11.8 33.8-3.5zM301.1 34.8C312.6 40 320 51.4 320 64l0 384c0 12.6-7.4 24-18.9 29.2s-25 3.1-34.4-5.3L131.8 352 64 352c-35.3 0-64-28.7-64-64l0-64c0-35.3 28.7-64 64-64l67.8 0L266.7 40.1c9.4-8.4 22.9-10.4 34.4-5.3z"/></svg>
    `}getUnmuteIcon(){return`
      <svg xmlns="http://www.w3.org/2000/svg" width="15" viewBox="0 0 576 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M301.1 34.8C312.6 40 320 51.4 320 64l0 384c0 12.6-7.4 24-18.9 29.2s-25 3.1-34.4-5.3L131.8 352 64 352c-35.3 0-64-28.7-64-64l0-64c0-35.3 28.7-64 64-64l67.8 0L266.7 40.1c9.4-8.4 22.9-10.4 34.4-5.3zM425 167l55 55 55-55c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-55 55 55 55c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-55-55-55 55c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l55-55-55-55c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"/></svg>
    `}getPlayIcon(){return`
      <svg xmlns="http://www.w3.org/2000/svg" width="15" viewBox="0 0 384 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80L0 432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg>
    `}}customElements.define("wgt-video-player",WgtVideoPlayer);